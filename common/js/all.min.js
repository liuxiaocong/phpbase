var utils=utils||{};utils=function(a){var a=a||{};return Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),a.getPlatform=function(){var a=navigator.userAgent.toLowerCase();return/iP(od|hone|ad)/i.test(a)?"ios":/android/i.test(a)?"android":"others"},a.TemplateEngine=function(a,b){for(var c=/\[#(.+?)#\]/g,d=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,e="var r=[];\n",f=0,g=function(a,b){return e+=b?a.match(d)?a+"\n":"r.push("+a+");\n":""!=a?'r.push("'+a.replace(/"/g,'\\"')+'");\n':"",g};match=c.exec(a);)g(a.slice(f,match.index))(match[1],!0),f=match.index+match[0].length;return g(a.substr(f,a.length-f)),e+='return r.join("");',new Function(e.replace(/[\r\t\n]/g,"")).apply(b)},a.log_server=function(a){if(!a)return a;var b=document.createElement("img"),c="/log.do?";for(var d in a)a.hasOwnProperty(d)&&(c+=d+"="+encodeURIComponent(a[d])+"&");"&"===c.substr(-1)&&(c=c.substr(0,c.length-1)),b.src=c,b.onload=function(){console.log("log to server: ",c)}},a.get=function(b){return a.ajax(b.url,b.cb,b.method,b.post,b.contenttype,b.timeout)},a.ajax=a.tinyxhr=function(a,b,c,d,e,f){var g,h,f=f||16e3;try{h=new XMLHttpRequest}catch(i){try{h=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){return console&&console.log("tinyxhr: XMLHttpRequest not supported"),null}}g=setTimeout(function(){h.abort(),g&&b(new Error("tinyxhr: aborted by a timeout",998),"",h)},f),h.onreadystatechange=function(){4===h.readyState&&(clearTimeout(g),g=null,b(200!==h.status?new Error("tinyxhr: server respnse status is "+h.status):h.responseText,h))},h.open(c?c.toUpperCase():"GET",a,!0),d?(console.log(d),h.setRequestHeader("Content-type",e?e:"application/x-www-form-urlencoded"),h.send(d)):h.send()},a.getURLParameter=function(a){return decodeURIComponent((new RegExp("[?|&]"+a+"="+"([^&;]+?)(&|#|;|$)").exec(location.search)||[,""])[1].replace(/\+/g,"%20"))||null},a.whenReady=function(){function a(a){if(!c&&("readystatechange"!==a.type||"complete"===document.readyState)){if(b&&b.length)for(var d=0;d<b.length;d++)c||b[d].call(document);c=!0,b=[]}}var b=[],c=!1;return document.addEventListener?(document.addEventListener("DOMContentLoaded",a,!1),document.addEventListener("readystatechange",a,!1),window.addEventListener("load",a,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",a),window.attachEvent("onload",a)),function(a,d){c?a.call(document):d?b.unshift(a):b.push(a)}}(),a.extend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a}(utils);var mquery=function(a){function b(b){return this.elements=b,a.extend(this,{getAll:function(){return this.elements},val:function(a){return void 0!==a?(this.elements[0].value=a,this):this.elements[0].value},attr:function(a,b){return void 0!==b?(this.elements[0].setAttribute(a,b),this):this.elements[0].getAttribute(a)},data:function(a,b){return void 0!==b?(this.elements[0].setAttribute("data-"+a.toLowerCase(),b),this):this.elements[0].getAttribute("data-"+a.toLowerCase())},css:function(a,b){if(void 0!==b){for(var c=0;c<this.elements.length;c++)this.elements[c].style[a]=b;return this}return this.elements[0].style[a]},count:function(){return this.elements.length},get:function(a){return this.elements[a||0]},find:function(a){return c(this.elements[0].querySelectorAll(a))},remove:function(){for(var a=0;a<this.elements.length;a++){var b=this.elements[a];b.parentNode.removeChild(b)}return this},append:function(a){if("string"==typeof a){var b=document.createElement("div");b.innerHTML=a.trim(),b=b.firstChild,this.elements[0].appendChild(b)}else a&&this.elements[0].appendChild(a);return this},html:function(a){if(this.elements.length<1)return a?this:"";if(void 0===a)return this.elements[0].innerHTML;for(var b=0;b<this.elements.length;b++)this.elements[b].innerHTML=a;return this},appendText:function(a){for(var b=0;b<this.elements.length;b++)this.elements[b].innerHTML=this.elements[b].innerHTML+a;return this},empty:function(){for(var a=0;a<this.elements.length;a++)this.elements[a].innerHTML="";return this},hasClass:function(a,b){var c=b||0;return(" "+this.elements[c].className.split(/\s+/g).join(" ")+" ").indexOf(" "+a+" ")>-1},addClass:function(a){for(var c=0,d=b.length;d>c;c++)for(var e=a.split(/\s+/g),f=0;f<e.length;f++)this.hasClass(e[f],c)||(b[c].className+=" "+e[f]);return this},removeClass:function(a){var c,h,d=0,e=0,f=0,g=b.length,i=a.split(/\s+/g);for(d=0;g>d;d++){for(c=b[d].className.split(/\s+/g),e=0,h=i.length;h>e;e++)for(f=0;f<c.length;f++)if(c[f]===i[e]){c.splice(f,1);break}b[d].className=c.join(" ")}return this},bind:function(a,b,c){for(var d=function(){b&&b.apply(this,arguments)},e=0;e<this.elements.length;e++){var g,f=this.elements[e];if(c&&f["handlers_"+a]){for(var h=0;h<f["handlers_"+a].length;h++)g=f["handlers_"+a][h],f.removeEventListener(a,g,!1);f["handlers_"+a]=null}f.addEventListener(a,d,!1),f["handlers_"+a]?f["handlers_"+a].push(d):f["handlers_"+a]=[d]}return this},each:function(a){for(var b=0;b<this.elements.length;b++)a.call(this.elements[b],b);return this},hide:function(a){for(var b=0;b<this.elements.length;b++)this.elements[b].style.height=0,this.elements[b].style.opacity=0,a||(this.elements[b].style.display="none");return this},show:function(a){for(var a=a||"block",b=0;b<this.elements.length;b++)this.elements[b].style.display=a,this.elements[b].style.height="auto",this.elements[b].style.opacity=1;return this},showWithTime:function(a){var b=this.elements;if(!(b[0].style.opacity>=1))return this.slock||function(a){this.slock=!0;var c=1/(a/20),d=0;this.process=setInterval(function(){d+=c;for(var a=0;a<b.length;a++)b[a].style.opacity=d+c;d>=1&&(this.process=null,this.slock=!1)},50)}(a),this}}),this}var c=function(a){var c=[];"string"==typeof a?c=document.querySelectorAll(a):"[object NodeList]"===a.toString()?c=a:a.querySelectorAll&&(c=[a]);var d=new b(c);return d};return c}(utils);!function(a){var b=0;a.dialog=function(c){var c=a.extend({id:"dialog_"+b++,type:"alert",title:"untitled",msg:"",okBtn:"ok",cancelBtn:"cancel",showCancelBtn:!0,showOkBtn:!0,okBtnAutoclose:!0,callback:void 0,bindfunction:void 0,showTitle:!0},c),d=this,e=mquery("#tmpl_dialog").html(),f=a.TemplateEngine(e,c);mquery(document.body).append(f);var g=mquery("#"+c.id);return d.node=g,d.close=function(){g.remove(),mquery(document.body).css("overflow","auto")},g.find(".btnCancel").bind("click",d.close),c.okBtnAutoclose&&g.find(".btnOk").bind("click",d.close),g.find(".btnOk").bind("click",function(){c.callback&&c.callback.apply(d)}),c.bindfunction&&c.bindfunction.apply(g),g.show(),mquery(document.body).css("overflow","hidden"),d},a.alert=function(b,c){return new a.dialog({title:b,msg:c,showCancelBtn:!1})}}(utils||{});